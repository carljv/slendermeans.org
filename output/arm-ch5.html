<!DOCTYPE html>
<html lang="en">

<head>
    <title> Slender Means </title>
    <meta charset="utf-8">

    <link rel="shortcut icon" type="image/x-icon" href="./theme/images/favicon.ico">

    <link href="./theme/css/tango_code.css" rel="stylesheet">
    <link href="./theme/css/webfonts.css" rel="stylesheet">
    <link href="./theme/css/layout.css" rel="stylesheet">
    <link href="./theme/css/type.css" rel="stylesheet">
    <link href="./theme/css/color-decor.css" rel="stylesheet">
    <link href="./theme/css/fontawesome/font-awesome.min.css" rel="stylesheet">
</head>

<body>
  <header id="top-matter">
    <!-- The Top Matter is comprised of the site Logo (which includes an image,
    the site slogan and the site name), and the Main Navigation menu. -->

    <hgroup id="logo">
        <a href="./index.html">
        <!-- The graphic/title logo is a link that points home. The logo contains the site slogan and title, the text of which are styled in logo.css -->
        <h1 id="site-name">
          <span id="S">s</span><span id="lender">lender</span>
          <span id="M">m</span><span id="eans">eans</span>
        </h1>
        <h2 id="site-tag"> i'd like to drop my trousers to the world i am a man of means of </h2>
      </a>
    </hgroup>
    <nav id="main-nav">
    <!-- The navigation bar with links to site pages -->
        <ul>
          <!-- Home and Archives are listed explicitly -->
          <li><a href="./index.html">Home</a></li>
          <li><a href="./archives.html">Archives</a></li>

          <!-- Others are in PAGES variable, though we exclude the colophon
          page, whose link will go at the site's end-matter footer -->
              <li > <a href="./pages/about.html"> About </a></li>
              <li > <a href="./pages/blogroll.html"> Blogroll </a></li>
              <li > <a href="./pages/will-it-python.html"> Will it  Python? </a></li>
        </ul>
    </nav>
  </header>
      <!-- For pages that have a title describing their content -->

  <div id="content">
    <article class="h-entry">
      <h1 class="p-name"><a href = "./arm-ch5.html" rel = "bookmark"> <i><span class="caps">ARM</span></i> Chapter 5: Logistic models of well-switching in Bangladesh </a></h1>

      <!-- Post info has date, author, and category -->
      <footer class="article-panel post-info">
        <ul>
          <li><time class="dt-published" datetime="2012-12-22T19:10:00" pubdate> December 22, 2012 </time></li>
            <li> <address class="p-author h-card"><a href="./author/carl.html"> Carl </a></address></li>
              <li><a class = "p-category" href="./category/will-it-python.html"> Will it Python </a></li>
        </ul>
      </footer>

      <div class="e-content">
        <p>The logistic regression we ran for <a href="../ml4h-ch2-p2.html">chapter 2 of <em>Machine Learning for
Hackers</em></a> was pretty simple. So I wanted to find an example that would
dig a little deeper into statsmodels&#8217;s capabilities and the power of the
patsy formula language.</p>
<p>So, I&#8217;m taking an intermission from <em>Machine Learning for Hackers</em> and
am going to show an example from Gelman and Hill&#8217;s <a href="http://www.stat.columbia.edu/~gelman/arm/"><em>Data Analysis Using
Regression and Multilevel/Hierarchical Models</em></a> <em>(&#8220;<span class="caps">ARM</span>&#8221;)</em>. The chapter
has a great example of going through the process of building,
interpreting, and diagnosing a logistic regression model. We&#8217;ll end up
with a model with lots of interactions and variable transforms, which is
a great showcase for patsy and the statmodels formula <span class="caps">API</span>.</p>
<h2>Logistic model of well-switching in Bangladesh</h2>
<p>Our data are information on about 3,000 respondent households in
Bangladesh with wells having an unsafe amount of arsenic. The data
record the amount of arsenic in the respondent&#8217;s well, the distance to
the nearest safe well (in meters), whether that respondent &#8220;switched&#8221;
wells by using a neighbor&#8217;s safe well instead of their own, as well as
the respondent&#8217;s years of education and a dummy variable indicating
whether they belong to a community association.</p>
<div class="highlight"><pre>  <span class="k">switch</span> <span class="n">arsenic</span>      <span class="n">dist</span> <span class="n">assoc</span> <span class="n">educ</span>
<span class="mi">1</span>      <span class="mi">1</span>    <span class="mf">2.36</span> <span class="mf">16.826000</span>     <span class="mi">0</span>    <span class="mi">0</span>
<span class="mi">2</span>      <span class="mi">1</span>    <span class="mf">0.71</span> <span class="mf">47.321999</span>     <span class="mi">0</span>    <span class="mi">0</span>
<span class="mi">3</span>      <span class="mi">0</span>    <span class="mf">2.07</span> <span class="mf">20.966999</span>     <span class="mi">0</span>   <span class="mi">10</span>
<span class="mi">4</span>      <span class="mi">1</span>    <span class="mf">1.15</span> <span class="mf">21.486000</span>     <span class="mi">0</span>   <span class="mi">12</span>
<span class="mi">5</span>      <span class="mi">1</span>    <span class="mf">1.10</span> <span class="mf">40.874001</span>     <span class="mi">1</span>   <span class="mi">14</span>
<span class="p">...</span>
</pre></div>


<p>Our goal is to model well-switching decision. Since it&#8217;s a binary
variable (1 = switch, 0 = no switch), we&#8217;ll use logistic regression.</p>
<p>The IPython notebook is at the Github repo <a href="https://github.com/carljv/Will_it_Python/tree/master/ARM/ch5">here</a>, and you can go
<a href="http://nbviewer.ipython.org/urls/raw.github.com/carljv/Will_it_Python/master/ARM/ch5/arsenic_wells_switching.ipynb">here</a> to view it on nbviewer. The analysis follows <em><span class="caps">ARM</span></em> chapter
5.4.</p>
<h2>Model 1: Distance to a safe well</h2>
<p>For our first pass, we&#8217;ll just use the distance to the nearest safe
well. Since the distance is recorded in meters, and the effect of one
meter is likely to be very small, we can get nicer model coefficients if
we scale it. Instead of creating a new scaled variable, we&#8217;ll just do it
in the formula description using the <code>I()</code> function.</p>
<div class="highlight"><pre><span class="n">model1</span> <span class="o">=</span> <span class="n">logit</span><span class="p">(</span><span class="s">&#39;switch ~ I(dist/100.)&#39;</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">print</span> <span class="n">model1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>


<p>Optimization terminated successfully.
    Current function value: 2038.118913
    Iterations 4
    Logit Regression Results</p>
<div class="highlight"><pre><span class="o">==============================================================================</span>
<span class="n">Dep</span><span class="p">.</span> <span class="n">Variable</span><span class="o">:</span> <span class="k">switch</span> <span class="n">No</span><span class="p">.</span> <span class="n">Observations</span><span class="o">:</span> <span class="mi">3020</span>
<span class="nl">Model:</span> <span class="n">Logit</span> <span class="n">Df</span> <span class="n">Residuals</span><span class="o">:</span> <span class="mi">3018</span>
<span class="nl">Method:</span> <span class="n"><span class="caps">MLE</span></span> <span class="n">Df</span> <span class="n">Model</span><span class="o">:</span> <span class="mi">1</span>
<span class="nl">Date:</span> <span class="n">Sat</span><span class="p">,</span> <span class="mi">22</span> <span class="n">Dec</span> <span class="mi">2012</span> <span class="n">Pseudo</span> <span class="n">R</span><span class="o">-</span><span class="n">squ</span><span class="p">.</span><span class="o">:</span> <span class="mf">0.01017</span>
<span class="nl">Time:</span> <span class="mi">13</span><span class="o">:</span><span class="mo">05</span><span class="o">:</span><span class="mi">25</span> <span class="n">Log</span><span class="o">-</span><span class="n">Likelihood</span><span class="o">:</span> <span class="o">-</span><span class="mf">2038.1</span>
<span class="nl">converged:</span> <span class="n">True</span> <span class="n"><span class="caps">LL</span></span><span class="o">-</span><span class="n">Null</span><span class="o">:</span> <span class="o">-</span><span class="mf">2059.0</span>
<span class="n"><span class="caps">LLR</span></span> <span class="n">p</span><span class="o">-</span><span class="n">value</span><span class="o">:</span> <span class="mf">9.798e-11</span>

<span class="o">==================================================================================</span>
<span class="n">coef</span> <span class="n">std</span> <span class="n">err</span> <span class="n">z</span> <span class="n">P</span><span class="o">&gt;|</span><span class="n">z</span><span class="o">|</span> <span class="p">[</span><span class="mf">95.0</span><span class="o">%</span> <span class="n">Conf</span><span class="p">.</span> <span class="n">Int</span><span class="p">.]</span>

<span class="o">----------------------------------------------------------------------------------</span>
<span class="n">Intercept</span> <span class="mf">0.6060</span> <span class="mf">0.060</span> <span class="mf">10.047</span> <span class="mf">0.000</span> <span class="mf">0.488</span> <span class="mf">0.724</span>
<span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.6219</span> <span class="mf">0.097</span> <span class="o">-</span><span class="mf">6.383</span> <span class="mf">0.000</span> <span class="o">-</span><span class="mf">0.813</span> <span class="o">-</span><span class="mf">0.431</span>
</pre></div>


<p>Let&#8217;s plot this model. We&#8217;ll want to jitter the <code>switch</code> data, since
it&#8217;s all 0/1 and will over-plot.</p>
<p><a href="../images/switch_dist_jittter.png">
    <img src="../images/switch_dist_jittter.png" width=400px />
</a></p>
<p>Another way to look at this is to plot the densities of distance for
switchers and non-switchers. We expect the distribution of switchers to
have more mass over short distances and the distribution of
non-switchers to have more mass over long distances.</p>
<p><a href="../images/switch_dist_kde.png">
    <img src="../images/switch_dist_kde.png" width=400px />
</a></p>
<h2>Model 2: Distance to a safe well and the arsenic level of own well</h2>
<p>Next, let&#8217;s add the arsenic level as a regressor. We&#8217;d expect
respondents with higher arsenic levels to be more motivated to switch.</p>
<div class="highlight"><pre><span class="n">model2</span> <span class="o">=</span> <span class="n">logit</span><span class="p">(</span><span class="s">&#39;switch ~ I(dist / 100.) + arsenic&#39;</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">print</span> <span class="n">model2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>



<span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">Current</span> <span class="n">function</span> <span class="n">value</span><span class="p">:</span> <span class="mf">1965.334134</span>
<span class="n">Iterations</span> <span class="mi">5</span>
<span class="n">Logit</span> <span class="n">Regression</span> <span class="n">Results</span>

<span class="o">==============================================================================</span>
<span class="n">Dep</span><span class="o">.</span> <span class="n">Variable</span><span class="p">:</span> <span class="n">switch</span> <span class="n">No</span><span class="o">.</span> <span class="n">Observations</span><span class="p">:</span> <span class="mi">3020</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Logit</span> <span class="n">Df</span> <span class="n">Residuals</span><span class="p">:</span> <span class="mi">3017</span>
<span class="n">Method</span><span class="p">:</span> <span class="n"><span class="caps">MLE</span></span> <span class="n">Df</span> <span class="n">Model</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Sat</span><span class="p">,</span> <span class="mi">22</span> <span class="n">Dec</span> <span class="mi">2012</span> <span class="n">Pseudo</span> <span class="n">R</span><span class="o">-</span><span class="n">squ</span><span class="o">.</span><span class="p">:</span> <span class="mf">0.04551</span>
<span class="n">Time</span><span class="p">:</span> <span class="mi">13</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">29</span> <span class="n">Log</span><span class="o">-</span><span class="n">Likelihood</span><span class="p">:</span> <span class="o">-</span><span class="mf">1965.3</span>
<span class="n">converged</span><span class="p">:</span> <span class="bp">True</span> <span class="n"><span class="caps">LL</span></span><span class="o">-</span><span class="n">Null</span><span class="p">:</span> <span class="o">-</span><span class="mf">2059.0</span>
<span class="n"><span class="caps">LLR</span></span> <span class="n">p</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="mf">1.995e-41</span>

<span class="o">==================================================================================</span>
<span class="n">coef</span> <span class="n">std</span> <span class="n">err</span> <span class="n">z</span> <span class="n">P</span><span class="o">&gt;|</span><span class="n">z</span><span class="o">|</span> <span class="p">[</span><span class="mf">95.0</span><span class="o">%</span> <span class="n">Conf</span><span class="o">.</span> <span class="n">Int</span><span class="o">.</span><span class="p">]</span>

<span class="o">----------------------------------------------------------------------------------</span>
<span class="n">Intercept</span> <span class="mf">0.0027</span> <span class="mf">0.079</span> <span class="mf">0.035</span> <span class="mf">0.972</span> <span class="o">-</span><span class="mf">0.153</span> <span class="mf">0.158</span>
<span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.8966</span> <span class="mf">0.104</span> <span class="o">-</span><span class="mf">8.593</span> <span class="mf">0.000</span> <span class="o">-</span><span class="mf">1.101</span> <span class="o">-</span><span class="mf">0.692</span>
<span class="n">arsenic</span> <span class="mf">0.4608</span> <span class="mf">0.041</span> <span class="mf">11.134</span> <span class="mf">0.000</span> <span class="mf">0.380</span> <span class="mf">0.542</span>

<span class="o">==================================================================================</span>
</pre></div>


<p>Which is what we see. The coefficients are what we&#8217;d expect: the farther
to a safe well, the less likely a respondent is to switch, but the
higher the arsenic level in their own well, the more likely.</p>
<h3>Marginal Effects</h3>
<p>To see the effect of these on the probability of switching, let&#8217;s
calculate the marginal effects at the mean of the data.</p>
<div class="highlight"><pre><span class="n">model2</span><span class="o">.</span><span class="n">margeff</span><span class="p">(</span><span class="n">at</span> <span class="o">=</span> <span class="s">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.21806505</span><span class="p">,</span> <span class="mf">0.11206108</span><span class="p">])</span>
</pre></div>


<p>So, for the mean respondent, an increase of 100 meters to the nearest
safe well is associated with a 22% lower probability of switching. But
an increase of 1 in the arsenic level is associated with an 11% higher
probability of switching.</p>
<h3>Class separability</h3>
<p>To get a sense of how well this model might classify switchers and
non-switchers, we can plot each class of respondent in
(distance-arsenic)-space.
We don&#8217;t see very clean separation, so we&#8217;d expect the model to have a
fairly high error rate. But we do notice that the
short-distance/high-arsenic region of the graph is mostly comprised
switchers, and the long-distance/low-arsenic region is mostly comprised
of non-switchers.</p>
<p><a href="../images/dist_arsenic_sep.png">
    <img src="../images/dist_arsenic_sep.png" width=400px />
</a></p>
<h2>Model 3: Adding an interaction</h2>
<p>It&#8217;s sensible that distance and arsenic would interact in the model. In
other words, the effect of an 100 meters on your decision to switch
would be affected by how much arsenic is in your well.</p>
<p>Again, we don&#8217;t have to pre-compute an explicit interaction variable. We
can just specify an interaction in the formula description using the <code>:</code>
operator.</p>
<div class="highlight"><pre><span class="n">model3</span> <span class="o">=</span> <span class="n">logit</span><span class="p">(</span><span class="s">&#39;switch ~ I(dist / 100.) + arsenic + I(dist / 100.):arsenic&#39;</span><span class="p">,</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">print</span> <span class="n">model3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>


<span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">Current</span> <span class="n">function</span> <span class="n">value</span><span class="p">:</span> <span class="mf">1963.814202</span>
<span class="n">Iterations</span> <span class="mi">5</span>
<span class="n">Logit</span> <span class="n">Regression</span> <span class="n">Results</span>

<span class="o">==============================================================================</span>
<span class="n">Dep</span><span class="o">.</span> <span class="n">Variable</span><span class="p">:</span> <span class="n">switch</span> <span class="n">No</span><span class="o">.</span> <span class="n">Observations</span><span class="p">:</span> <span class="mi">3020</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Logit</span> <span class="n">Df</span> <span class="n">Residuals</span><span class="p">:</span> <span class="mi">3016</span>
<span class="n">Method</span><span class="p">:</span> <span class="n"><span class="caps">MLE</span></span> <span class="n">Df</span> <span class="n">Model</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Sat</span><span class="p">,</span> <span class="mi">22</span> <span class="n">Dec</span> <span class="mi">2012</span> <span class="n">Pseudo</span> <span class="n">R</span><span class="o">-</span><span class="n">squ</span><span class="o">.</span><span class="p">:</span> <span class="mf">0.04625</span>
<span class="n">Time</span><span class="p">:</span> <span class="mi">13</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">33</span> <span class="n">Log</span><span class="o">-</span><span class="n">Likelihood</span><span class="p">:</span> <span class="o">-</span><span class="mf">1963.8</span>
<span class="n">converged</span><span class="p">:</span> <span class="bp">True</span> <span class="n"><span class="caps">LL</span></span><span class="o">-</span><span class="n">Null</span><span class="p">:</span> <span class="o">-</span><span class="mf">2059.0</span>
<span class="n"><span class="caps">LLR</span></span> <span class="n">p</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="mf">4.830e-41</span>

<span class="o">==========================================================================================</span>
<span class="n">coef</span> <span class="n">std</span> <span class="n">err</span> <span class="n">z</span> <span class="n">P</span><span class="o">&gt;|</span><span class="n">z</span><span class="o">|</span> <span class="p">[</span><span class="mf">95.0</span><span class="o">%</span> <span class="n">Conf</span><span class="o">.</span> <span class="n">Int</span><span class="o">.</span><span class="p">]</span>

<span class="o">------------------------------------------------------------------------------------------</span>
<span class="n">Intercept</span> <span class="o">-</span><span class="mf">0.1479</span> <span class="mf">0.118</span> <span class="o">-</span><span class="mf">1.258</span> <span class="mf">0.208</span> <span class="o">-</span><span class="mf">0.378</span> <span class="mf">0.083</span>
<span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.5772</span> <span class="mf">0.209</span> <span class="o">-</span><span class="mf">2.759</span> <span class="mf">0.006</span> <span class="o">-</span><span class="mf">0.987</span> <span class="o">-</span><span class="mf">0.167</span>
<span class="n">arsenic</span> <span class="mf">0.5560</span> <span class="mf">0.069</span> <span class="mf">8.021</span> <span class="mf">0.000</span> <span class="mf">0.420</span> <span class="mf">0.692</span>
<span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">):</span><span class="n">arsenic</span> <span class="o">-</span><span class="mf">0.1789</span> <span class="mf">0.102</span> <span class="o">-</span><span class="mf">1.748</span> <span class="mf">0.080</span> <span class="o">-</span><span class="mf">0.379</span> <span class="mf">0.022</span>

<span class="o">==========================================================================================</span>
</pre></div>


<p>The coefficient on the interaction is negative and significant. While we
can&#8217;t directly intepret its quantitative effect on switching, the
qualitative interpretation gels with our intuition. Distance has a
negative effect on switching, but this negative effect is reduced when
arsenic levels are high. Alternatively, the arsenic level have a
positive effect on switching, but this positive effect is reduced as
distance to the nearest safe well increases.</p>
<h2>Model 4: Adding education, more interactions, and centering variables</h2>
<p>Respondents with more eduction might have a better understanding of the
harmful effects of arsenic and therefore may be more likely to switch.
Education is in years, so we&#8217;ll scale it for more sensible coefficients.
We&#8217;ll also include interactions amongst all the regressors.</p>
<p>We&#8217;re also going to center the variables, to help with interpretation of
the coefficients. Once more, we can just do this in the formula, without
pre-computing centered variables.</p>
<div class="highlight"><pre><span class="n">model_form</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;switch ~ center(I(dist / 100.)) + center(arsenic) + &#39;</span> <span class="o">+</span>
              <span class="s">&#39;center(I(educ / 4.)) + &#39;</span> <span class="o">+</span>
              <span class="s">&#39;center(I(dist / 100.)) : center(arsenic) + &#39;</span> <span class="o">+</span>
              <span class="s">&#39;center(I(dist / 100.)) : center(I(educ / 4.)) + &#39;</span> <span class="o">+</span>
              <span class="s">&#39;center(arsenic) : center(I(educ / 4.))&#39;</span>
             <span class="p">)</span>
<span class="n">model4</span> <span class="o">=</span> <span class="n">logit</span><span class="p">(</span><span class="n">model_form</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">print</span> <span class="n">model4</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>




<span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">Current</span> <span class="n">function</span> <span class="n">value</span><span class="p">:</span> <span class="mf">1945.871775</span>
<span class="n">Iterations</span> <span class="mi">5</span>
<span class="n">Logit</span> <span class="n">Regression</span> <span class="n">Results</span>

<span class="o">==============================================================================</span>
<span class="n">Dep</span><span class="o">.</span> <span class="n">Variable</span><span class="p">:</span> <span class="n">switch</span> <span class="n">No</span><span class="o">.</span> <span class="n">Observations</span><span class="p">:</span> <span class="mi">3020</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Logit</span> <span class="n">Df</span> <span class="n">Residuals</span><span class="p">:</span> <span class="mi">3013</span>
<span class="n">Method</span><span class="p">:</span> <span class="n"><span class="caps">MLE</span></span> <span class="n">Df</span> <span class="n">Model</span><span class="p">:</span> <span class="mi">6</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Sat</span><span class="p">,</span> <span class="mi">22</span> <span class="n">Dec</span> <span class="mi">2012</span> <span class="n">Pseudo</span> <span class="n">R</span><span class="o">-</span><span class="n">squ</span><span class="o">.</span><span class="p">:</span> <span class="mf">0.05497</span>
<span class="n">Time</span><span class="p">:</span> <span class="mi">13</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">35</span> <span class="n">Log</span><span class="o">-</span><span class="n">Likelihood</span><span class="p">:</span> <span class="o">-</span><span class="mf">1945.9</span>
<span class="n">converged</span><span class="p">:</span> <span class="bp">True</span> <span class="n"><span class="caps">LL</span></span><span class="o">-</span><span class="n">Null</span><span class="p">:</span> <span class="o">-</span><span class="mf">2059.0</span>
<span class="n"><span class="caps">LLR</span></span> <span class="n">p</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="mf">4.588e-46</span>

<span class="o">===============================================================================================================</span>
<span class="n">coef</span> <span class="n">std</span> <span class="n">err</span> <span class="n">z</span> <span class="n">P</span><span class="o">&gt;|</span><span class="n">z</span><span class="o">|</span> <span class="p">[</span><span class="mf">95.0</span><span class="o">%</span> <span class="n">Conf</span><span class="o">.</span> <span class="n">Int</span><span class="o">.</span><span class="p">]</span>

<span class="o">---------------------------------------------------------------------------------------------------------------</span>
<span class="n">Intercept</span> <span class="mf">0.3563</span> <span class="mf">0.040</span> <span class="mf">8.844</span> <span class="mf">0.000</span> <span class="mf">0.277</span> <span class="mf">0.435</span>
<span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">))</span> <span class="o">-</span><span class="mf">0.9029</span> <span class="mf">0.107</span> <span class="o">-</span><span class="mf">8.414</span> <span class="mf">0.000</span> <span class="o">-</span><span class="mf">1.113</span> <span class="o">-</span><span class="mf">0.693</span>
<span class="n">center</span><span class="p">(</span><span class="n">arsenic</span><span class="p">)</span> <span class="mf">0.4950</span> <span class="mf">0.043</span> <span class="mf">11.497</span> <span class="mf">0.000</span> <span class="mf">0.411</span> <span class="mf">0.579</span>
<span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">educ</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">))</span> <span class="mf">0.1850</span> <span class="mf">0.039</span> <span class="mf">4.720</span> <span class="mf">0.000</span> <span class="mf">0.108</span> <span class="mf">0.262</span>
<span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)):</span><span class="n">center</span><span class="p">(</span><span class="n">arsenic</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.1177</span> <span class="mf">0.104</span> <span class="o">-</span><span class="mf">1.137</span> <span class="mf">0.256</span>
<span class="o">-</span><span class="mf">0.321</span> <span class="mf">0.085</span>
<span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)):</span><span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">educ</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">))</span> <span class="mf">0.3227</span> <span class="mf">0.107</span> <span class="mf">3.026</span> <span class="mf">0.002</span>
<span class="mf">0.114</span> <span class="mf">0.532</span>
<span class="n">center</span><span class="p">(</span><span class="n">arsenic</span><span class="p">):</span><span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">educ</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">))</span> <span class="mf">0.0722</span> <span class="mf">0.044</span> <span class="mf">1.647</span> <span class="mf">0.100</span> <span class="o">-</span><span class="mf">0.014</span>
<span class="mf">0.158</span>

<span class="o">===============================================================================================================</span>
</pre></div>


<h3>Model assessment: binned residual plots</h3>
<p>Plotting residuals to regressors can alert us to issues like
nonlinearity or heteroskedasticity. Plotting raw residuals in a binary
model isn&#8217;t usually informative, so we do some smoothing. Here, we&#8217;ll
averaging the residuals within bins of the regressor. (A lowess or
moving average might also work.)</p>
<p>I&#8217;m going to write a function to provide the binned residual data
dynamically (and another helper function to plot the data). To create
the bins I&#8217;m going to use the handy <code>qcut</code> function in pandas, which
bins a vector of data into quantiles. Then I&#8217;ll use <code>groupby</code> to
calculate the bin means and confidence intervals.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">bin_residuals</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compute average residuals within bins of a variable.</span>

<span class="sd">    Returns a dataframe indexed by the bins, with the bin midpoint,</span>
<span class="sd">    the residual average within the bin, and the confidence interval</span>
<span class="sd">    bounds.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">resid_df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s">&#39;var&#39;</span><span class="p">:</span> <span class="n">var</span><span class="p">,</span> <span class="s">&#39;resid&#39;</span><span class="p">:</span> <span class="n">resid</span><span class="p">})</span>
    <span class="n">resid_df</span><span class="p">[</span><span class="s">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qcut</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
    <span class="n">bin_group</span> <span class="o">=</span> <span class="n">resid_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&#39;bins&#39;</span><span class="p">)</span>
    <span class="n">bin_df</span> <span class="o">=</span> <span class="n">bin_group</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">,</span> <span class="s">&#39;resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_group</span><span class="p">[</span><span class="s">&#39;resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;lower_ci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">bin_group</span><span class="p">[</span><span class="s">&#39;resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">/</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bin_group</span><span class="p">[</span><span class="s">&#39;resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
    <span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;upper_ci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">bin_group</span><span class="p">[</span><span class="s">&#39;resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">/</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]))</span>
    <span class="n">bin_df</span> <span class="o">=</span> <span class="n">bin_df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&#39;var&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">bin_df</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_binned_residuals</span><span class="p">(</span><span class="n">bin_df</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plotted binned residual averages and confidence intervals.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">],</span> <span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;resid&#39;</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">],</span> <span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;lower_ci&#39;</span><span class="p">],</span> <span class="s">&#39;-r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">],</span> <span class="n">bin_df</span><span class="p">[</span><span class="s">&#39;upper_ci&#39;</span><span class="p">],</span> <span class="s">&#39;-r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">arsenic_resids</span> <span class="o">=</span> <span class="n">bin_residuals</span><span class="p">(</span><span class="n">model4</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s">&#39;arsenic&#39;</span><span class="p">],</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">dist_resids</span> <span class="o">=</span> <span class="n">bin_residuals</span><span class="p">(</span><span class="n">model4</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s">&#39;dist&#39;</span><span class="p">],</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Residual (bin avg.)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Arsenic (bin avg.)&#39;</span><span class="p">)</span>
    <span class="n">plot_binned_residuals</span><span class="p">(</span><span class="n">arsenic_resids</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="n">plot_binned_residuals</span><span class="p">(</span><span class="n">dist_resids</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Residual (bin avg.)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Distance (bin avg.)&#39;</span><span class="p">)</span>
</pre></div>


<p><a href="../images/arsenic_dist_bin_resid.png">
    <img src="../images/arsenic_dist_bin_resid.png" width=400px />
</a></p>
<h2>Model 5: log-scaling arsenic</h2>
<p>The binned residual plot indicates some nonlinearity in the arsenic
variable. Note how the model over-estimated for low arsenic and
underestimates for high arsenic. This suggests a log transformation or
something similar.</p>
<p>We can again do this transformation right in the formula.</p>
<div class="highlight"><pre><span class="n">model_form</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;switch ~ center(I(dist / 100.)) +</span>
               <span class="n">center</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">arsenic</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39; +</span>
              <span class="s">&#39;center(I(educ / 4.)) + &#39;</span> <span class="o">+</span>
              <span class="s">&#39;center(I(dist / 100.)) : center(np.log(arsenic)) + &#39;</span> <span class="o">+</span>
              <span class="s">&#39;center(I(dist / 100.)) : center(I(educ / 4.)) + &#39;</span> <span class="o">+</span>
              <span class="s">&#39;center(np.log(arsenic)) : center(I(educ / 4.))&#39;</span>
             <span class="p">)</span>

<span class="n">model5</span> <span class="o">=</span> <span class="n">logit</span><span class="p">(</span><span class="n">model_form</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">print</span> <span class="n">model5</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>




<span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">Current</span> <span class="n">function</span> <span class="n">value</span><span class="p">:</span> <span class="mf">1931.554102</span>
<span class="n">Iterations</span> <span class="mi">5</span>
<span class="n">Logit</span> <span class="n">Regression</span> <span class="n">Results</span>

<span class="o">==============================================================================</span>
<span class="n">Dep</span><span class="o">.</span> <span class="n">Variable</span><span class="p">:</span> <span class="n">switch</span> <span class="n">No</span><span class="o">.</span> <span class="n">Observations</span><span class="p">:</span> <span class="mi">3020</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Logit</span> <span class="n">Df</span> <span class="n">Residuals</span><span class="p">:</span> <span class="mi">3013</span>
<span class="n">Method</span><span class="p">:</span> <span class="n"><span class="caps">MLE</span></span> <span class="n">Df</span> <span class="n">Model</span><span class="p">:</span> <span class="mi">6</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Sat</span><span class="p">,</span> <span class="mi">22</span> <span class="n">Dec</span> <span class="mi">2012</span> <span class="n">Pseudo</span> <span class="n">R</span><span class="o">-</span><span class="n">squ</span><span class="o">.</span><span class="p">:</span> <span class="mf">0.06192</span>
<span class="n">Time</span><span class="p">:</span> <span class="mi">13</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">57</span> <span class="n">Log</span><span class="o">-</span><span class="n">Likelihood</span><span class="p">:</span> <span class="o">-</span><span class="mf">1931.6</span>
<span class="n">converged</span><span class="p">:</span> <span class="bp">True</span> <span class="n"><span class="caps">LL</span></span><span class="o">-</span><span class="n">Null</span><span class="p">:</span> <span class="o">-</span><span class="mf">2059.0</span>
<span class="n"><span class="caps">LLR</span></span> <span class="n">p</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="mf">3.517e-52</span>

<span class="o">==================================================================================================================</span>
<span class="n">coef</span> <span class="n">std</span> <span class="n">err</span> <span class="n">z</span> <span class="n">P</span><span class="o">&gt;|</span><span class="n">z</span><span class="o">|</span> <span class="p">[</span><span class="mf">95.0</span><span class="o">%</span> <span class="n">Conf</span><span class="o">.</span> <span class="n">Int</span><span class="o">.</span><span class="p">]</span>

<span class="o">------------------------------------------------------------------------------------------------------------------</span>
<span class="n">Intercept</span> <span class="mf">0.3452</span> <span class="mf">0.040</span> <span class="mf">8.528</span> <span class="mf">0.000</span> <span class="mf">0.266</span> <span class="mf">0.425</span>
<span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">))</span> <span class="o">-</span><span class="mf">0.9796</span> <span class="mf">0.111</span> <span class="o">-</span><span class="mf">8.809</span> <span class="mf">0.000</span> <span class="o">-</span><span class="mf">1.197</span> <span class="o">-</span><span class="mf">0.762</span>
<span class="n">center</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">arsenic</span><span class="p">))</span> <span class="mf">0.9036</span> <span class="mf">0.070</span> <span class="mf">12.999</span> <span class="mf">0.000</span> <span class="mf">0.767</span> <span class="mf">1.040</span>
<span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">educ</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">))</span> <span class="mf">0.1785</span> <span class="mf">0.039</span> <span class="mf">4.577</span> <span class="mf">0.000</span> <span class="mf">0.102</span> <span class="mf">0.255</span>
<span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)):</span><span class="n">center</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">arsenic</span><span class="p">))</span> <span class="o">-</span><span class="mf">0.1567</span> <span class="mf">0.185</span> <span class="o">-</span><span class="mf">0.846</span>
<span class="mf">0.397</span> <span class="o">-</span><span class="mf">0.520</span> <span class="mf">0.206</span>
<span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)):</span><span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">educ</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">))</span> <span class="mf">0.3384</span> <span class="mf">0.108</span> <span class="mf">3.141</span> <span class="mf">0.002</span>
<span class="mf">0.127</span> <span class="mf">0.550</span>
<span class="n">center</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">arsenic</span><span class="p">)):</span><span class="n">center</span><span class="p">(</span><span class="n">I</span><span class="p">(</span><span class="n">educ</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">))</span> <span class="mf">0.0601</span> <span class="mf">0.070</span> <span class="mf">0.855</span> <span class="mf">0.393</span>
<span class="o">-</span><span class="mf">0.078</span> <span class="mf">0.198</span>

<span class="o">==================================================================================================================</span>
</pre></div>


<p>And the binned residual plot for arsenic now looks better.</p>
<p><a href="../images/logarsenic_dist_bin_resid.png">
    <img src="../images/logarsenic_dist_bin_resid.png" width=400px />
</a></p>
<h3>Model error rates</h3>
<p>The <code>pred_table()</code> gives us a confusion matrix for the model. We can use
this to compute the error rate of the model.</p>
<p>We should compare this to the null error rates, which comes from a model
that just classifies everything as whatever the most prevalent response
is. Here 58% of the respondents were switchers, so the null model just
classifies everyone as a switcher, and therefore has an error rate of
42%.</p>
<div class="highlight"><pre><span class="k">print</span> <span class="n">model5</span><span class="o">.</span><span class="n">pred_table</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&#39;Model Error rate: {0: 3.0%}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">model5</span><span class="o">.</span><span class="n">pred_table</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">model5</span><span class="o">.</span><span class="n">pred_table</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="k">print</span> <span class="s">&#39;Null Error Rate: {0: 3.0%}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s">&#39;switch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="p">[[</span> <span class="mf">568.</span> <span class="mf">715.</span><span class="p">]</span>
<span class="p">[</span> <span class="mf">387.</span> <span class="mf">1350.</span><span class="p">]]</span>
<span class="n">Model</span> <span class="n">Error</span> <span class="n">rate</span><span class="p">:</span> <span class="mi">36</span><span class="o">%</span>
<span class="n">Null</span> <span class="n">Error</span> <span class="n">Rate</span><span class="p">:</span> <span class="mi">42</span><span class="o">%</span>
</pre></div>


<h2>Conclusion</h2>
<p>So this was a more in-depth example of running a logistic regression
with statsmodels and the formula <span class="caps">API</span>. Unlike last time, when we were
just specifying the variables in the model, here we used the formula
language to apply transforms and create interactions. I really love
this: it drastically reduces the number of steps between thinking up a
model and fitting it.</p>
      </div>

      <nav class="article-panel social-links">
        <ul>
          <li><a href="http://twitter.com/share?text=Slender%20Means&url=./arm-ch5.html" class="social twitter">twitter</a></li>
          <li><a href="http://www.facebook.com/sharer/sharer.php?s=100&p[url]=./arm-ch5.html&p[images][0]=&p[title]=&p[summary]=" class="social facebook">facebook</a></li>
          <li><a href="https://plus.google.com/share?url=./arm-ch5.html" class="social gplus">google+</a></li>
        </ul>
      </nav>

    <section id="comments">
      <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_identifier = "arm-ch5.html";
          var disqus_url = "./arm-ch5.html";
          (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://slendermeans.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
    </div>
  </article>


  <!-- The site footer has a CC license link and a link to the colophon -->
  <footer id="end-matter">
    <ul>
      <li><a id="cc-license" title="license" rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US"> Creative Commons 3.0 </a></li>

      <li><a id="rss-link" title="rss" href="./feeds/all.atom.xml">RSS</a></li>

      <li><a id="colophon-link" title="colophon" href="./pages/colophon.html"> Colophon </a></li>
    </ul>
  </footer>

  <!-- This puts Google Analytics and Disqus comments scripts into each page -->
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43554300-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

<script type="text/javascript">
    var disqus_shortname = 'slendermeans';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>